# Use version 2.1 of the CircleCI pipeline process engine
version: 2.1

jobs: 
  create_infrastructure: 
    docker: 
      - image: amazon/aws-cli 

    steps: 
      - checkout 
      - run: 
          name: Create Cloudformation Stack 
          command: | 
            aws cloudformation create-stack \ 
              --template-body file://cloudformation/ec2-template.yml \ 
              --parameters file://cloudformation/ec2-parameters.json \
              --stack-name infraCiCdStack-${CIRCLE_WORKFLOW_ID:0:5} \ 
              --region us-east-1
              
workflows:
  my_workflow: 
    jobs: 
      - create_infrastructure

